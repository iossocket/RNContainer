### é¢˜å¤–è¯
React Nativeå·²ç»ğŸ”¥äº†å¾ˆä¹…äº†ï¼Œä»æŸç§ç¨‹åº¦ä¸Šè¯´å®ƒæé«˜äº†å¼€å‘æ•ˆç‡ï¼Œå°¤å…¶å¯¹åº”å¯¹æµ‹è¯•è¦†ç›–ç‡æœ‰è¾ƒé«˜è¦æ±‚æ—¶ï¼Œå†™æµ‹è¯•è€—è´¹çš„æ—¶é—´ç”šè‡³ä¼šè¶…è¿‡å†™å®ç°çš„æ—¶é—´ï¼Œæ ¹æ®ç¬”è€…åœ¨å¤šä¸ªçœŸå®é¡¹ç›®ä¸Šçš„å®è·µï¼Œå¦‚æœè¯´å†™iOSå’ŒAndroidä¸¤ä¸ªAppçš„æ—¶é—´æ˜¯2ï¼Œé‚£ä¹ˆé‡‡ç”¨React Nativeçš„æ—¶é—´ä¸º1.5 ~ 1.8ï¼Œè¿™0.3çš„å·®è·åœ¨äºå¯¹UIæ˜¯å¦æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œæ¯”å¦‚å¤æ‚çš„æ‰‹åŠ¿ã€åŠ¨ç”»è¦æ±‚ï¼Œä»¥åŠåœ¨éœ€è¦Native Moduleæ—¶ï¼Œæ²¡æœ‰åˆé€‚çš„ä¸‰æ–¹åº“éœ€è¦è‡ªå·±å®ç°ã€‚

é‚£åœ¨æŠ€æœ¯æ ˆå†³ç­–æ—¶ï¼Œæ˜¯å¦åº”è¯¥é€‰æ‹©RNï¼Œæˆ–æ˜¯å¦‚ä½•ä½¿ç”¨RNå‘¢ï¼Ÿï¼ˆä»¥ä¸‹è§‚ç‚¹ä»…ä»£è¡¨ä¸ªäººç»éªŒï¼‰ã€‚
1. å¯¹äºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå–å†³äºé¡¹ç›®çš„æ„¿æ™¯ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹ç®€å•çš„é‚£ä¹ˆRNæˆ–æ˜¯Flutterå†³å®šæ˜¯æœ€ä½³é€‰æ‹©ï¼›ä½†è‹¥é¡¹ç›®æ˜¯ä¸€ä¸ªåºç„¶å¤§ç‰©ï¼Œå¹¶ä¸”ä¼šæœ‰å¤šå›¢é˜Ÿåˆ†å¸ƒå¼å¼€å‘ï¼Œé‚£ä¹ˆæ›´å»ºè®®ä½¿ç”¨Hybridçš„æ–¹å¼ï¼Œå°†RNæˆ–Flutterä½œä¸ºFrameworkçš„æ–¹å¼å¼•å…¥ã€‚è¿™æ ·å¿…ç„¶ä¼šå¼•å…¥å·¥ç¨‹å¤æ‚åº¦ï¼Œæ—¢ç„¶å·²ç»æ˜¯ä¸ªå·¨å‹Appï¼Œé‚£ä¹ˆè¿™ä¸ªå¤æ‚åº¦å’Œæ•´ä½“æ•ˆç‡ä¸Šæ¯”è¾ƒï¼Œä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚
2. å¯¹äºä¸€ä¸ªå·²æœ‰é¡¹ç›®ï¼Œæ¨åˆ°ç”¨RNé‡å†™ï¼Œæ˜¯ä¸å»ºè®®çš„ã€‚å°¤å…¶åœ¨å¯¹RNæ²¡æœ‰æ·±åˆ»è®¤è¯†æ—¶ã€‚æ­¤æ—¶å¯æŒ‰ç…§[å®˜æ–¹æ–‡æ¡£](https://facebook.github.io/react-native/docs/integration-with-existing-apps#configuring-maven)é‡Œçš„é›†æˆæ–¹å¼ï¼Œç®€å•é›†æˆå°è¯•åï¼Œå†åšåˆ¤æ–­ã€‚
> Tipï¼š æ­¤å¤„å¹¶æ²¡æœ‰è€ƒè™‘åˆ°å›¢é˜Ÿæˆå‘˜çš„ç°æœ‰æŠ€æœ¯æ ˆï¼Œä½†ä½œä¸ºä¸€ä¸ªDeveloperï¼Œä¿æŒæŒç»­å­¦ä¹ ï¼Œå¿«é€ŸæŒæ¡æ–°æŠ€èƒ½ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªå¿…è¦æ¡ä»¶å§ã€‚

### å¼€å§‹

åˆšåˆšæåˆ°äº†[å®˜æ–¹æ–‡æ¡£](https://facebook.github.io/react-native/docs/integration-with-existing-apps#configuring-maven)ï¼Œè¿™ç§æ–¹å¼é›†æˆæ¯”è¾ƒæ–¹ä¾¿ï¼ŒåæœŸå‡çº§ä¹Ÿç›¸å¯¹å®¹æ˜“ï¼Œä½†å…¥ä¾µæ€§è¾ƒå¤§ï¼Œä¼šæ”¹å˜åŸæœ‰é¡¹ç›®ç»“æ„ã€‚Nativeä»£ç å’ŒRNä»£ç ä¼šæ‰åœ¨ä¸€èµ·ï¼Œé™ä½äº†å¯ç»´æŠ¤æ€§ã€‚

é‚£ä¹ˆå¦‚ä½•å°†RNä½œä¸ºä¸€ä¸ªFrameworkçš„æ–¹å¼å¼•å…¥å‘¢ï¼Ÿå°±åƒå¼•å…¥ä¸€ä¸ªæ™®é€šçš„ä¸‰æ–¹åº“ï¼š`pod 'MyRNModule', '0.0.1'`ã€‚åœ¨åŸæœ‰ä»£ç ä¸­åªéœ€è¦importè¿™ä¸ªmoduleï¼Œæ‹¿åˆ°å®ƒæš´éœ²å‡ºæ¥çš„ä¸€ä¸ªUIViewControllerï¼Œç„¶åæ­£å¸¸ä½¿ç”¨å’¯ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹é€šè¿‡å‘½ä»¤è¡Œæ„å»ºä¸€ä¸ªRNé¡¹ç›®åï¼Œ`ios`ç›®å½•ä¸‹çš„Podfileæ˜¯ä»€ä¹ˆæ ·çš„ï¼š
```ruby
platform :ios, '9.0'
require_relative '../node_modules/@react-native-community/cli-platform-ios/native_modules'

target 'Hybrid' do
  # Pods for Hybrid
  pod 'FBLazyVector', :path => "../node_modules/react-native/Libraries/FBLazyVector"
  pod 'FBReactNativeSpec', :path => "../node_modules/react-native/Libraries/FBReactNativeSpec"
  pod 'RCTRequired', :path => "../node_modules/react-native/Libraries/RCTRequired"
  pod 'RCTTypeSafety', :path => "../node_modules/react-native/Libraries/TypeSafety"
  pod 'React', :path => '../node_modules/react-native/'
  pod 'React-Core', :path => '../node_modules/react-native/'
  pod 'React-CoreModules', :path => '../node_modules/react-native/React/CoreModules'
  pod 'React-Core/DevSupport', :path => '../node_modules/react-native/'
  pod 'React-RCTActionSheet', :path => '../node_modules/react-native/Libraries/ActionSheetIOS'
  pod 'React-RCTAnimation', :path => '../node_modules/react-native/Libraries/NativeAnimation'
  pod 'React-RCTBlob', :path => '../node_modules/react-native/Libraries/Blob'
  pod 'React-RCTImage', :path => '../node_modules/react-native/Libraries/Image'
  pod 'React-RCTLinking', :path => '../node_modules/react-native/Libraries/LinkingIOS'
  pod 'React-RCTNetwork', :path => '../node_modules/react-native/Libraries/Network'
  pod 'React-RCTSettings', :path => '../node_modules/react-native/Libraries/Settings'
  pod 'React-RCTText', :path => '../node_modules/react-native/Libraries/Text'
  pod 'React-RCTVibration', :path => '../node_modules/react-native/Libraries/Vibration'
  pod 'React-Core/RCTWebSocket', :path => '../node_modules/react-native/'

  pod 'React-cxxreact', :path => '../node_modules/react-native/ReactCommon/cxxreact'
  pod 'React-jsi', :path => '../node_modules/react-native/ReactCommon/jsi'
  pod 'React-jsiexecutor', :path => '../node_modules/react-native/ReactCommon/jsiexecutor'
  pod 'React-jsinspector', :path => '../node_modules/react-native/ReactCommon/jsinspector'
  pod 'ReactCommon/jscallinvoker', :path => "../node_modules/react-native/ReactCommon"
  pod 'ReactCommon/turbomodule/core', :path => "../node_modules/react-native/ReactCommon"
  pod 'Yoga', :path => '../node_modules/react-native/ReactCommon/yoga'

  pod 'DoubleConversion', :podspec => '../node_modules/react-native/third-party-podspecs/DoubleConversion.podspec'
  pod 'glog', :podspec => '../node_modules/react-native/third-party-podspecs/glog.podspec'
  pod 'Folly', :podspec => '../node_modules/react-native/third-party-podspecs/Folly.podspec'

  target 'HybridTests' do
    inherit! :search_paths
    # Pods for testing
  end

  use_native_modules!
end
```
å®ƒå¼•å…¥äº†ä¸€ç³»åˆ—çš„libraryï¼Œè¿™äº›libéƒ½æ˜¯é€šè¿‡npmæ‹¿åˆ°æœ¬åœ°çš„ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯åœ¨`Podfile`ä¸­åªä¾èµ–ä¸€ä¸ª`MyRNModule`ï¼Œé‚£å°±éœ€è¦ä¸€ä¸ªç§æœ‰çš„podsï¼Œå¹¶ä¸”åœ¨`MyRNModule.podspec`ä¸­ä¾èµ–RNçš„è¿™äº›libã€‚
![rn.png](https://upload-images.jianshu.io/upload_images/19765376-c665c564685f290e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/400)

ä¾èµ–é—®é¢˜å°±å¯ä»¥è§£å†³äº†ï¼Œæ¥ä¸‹æ¥è¦åœ¨`MyRNModule`å†™ä¸€ä¸ªViewControllerï¼Œæ¥æ˜¾ç¤ºè§†å›¾ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹`AppDelegate.m`ä¸­éƒ½åšäº†ä»€ä¹ˆï¼š
```
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  RCTBridge *bridge = [[RCTBridge alloc] initWithDelegate:self launchOptions:launchOptions];
  RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:bridge
                                                   moduleName:@"Hybrid"
                                            initialProperties:nil];

  rootView.backgroundColor = [[UIColor alloc] initWithRed:1.0f green:1.0f blue:1.0f alpha:1];

  self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];
  UIViewController *rootViewController = [UIViewController new];
  rootViewController.view = rootView;
  self.window.rootViewController = rootViewController;
  [self.window makeKeyAndVisible];
  return YES;
}
```
å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä¹Ÿåªæ˜¯ä¸€äº›ç®€å•çš„æ“ä½œï¼Œåˆ›å»ºäº†ä¸€ä¸ª`rootViewController`ï¼Œç„¶åæŠŠ`RCTRootView`èµ‹å€¼ç»™å®ƒçš„`view`ã€‚OKï¼Œé‚£ä¹ˆæˆ‘ä»¬å¼€å·¥~

1. Private Cocoapods
ç§æœ‰podçš„æ­¥éª¤ç½‘ä¸Šæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚[è¿™ä¸ª](https://www.jianshu.com/p/0c640821b36f)ã€‚æˆ‘åœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚è¿™é‡Œé™„ä¸Šæˆ‘çš„ç§æœ‰[pod](https://github.com/iossocket/ReactNativeLib.git)ã€‚
ä¸‹é¢å°±å¼€å§‹ä½“åŠ›æ´»äº†ï¼ŒæŠŠPodfileä¸­çš„è¿™äº›ä¾èµ–çš„podspecæ–‡ä»¶ä¿®æ”¹åæ”¾åœ¨è‡ªå·±çš„ç§æœ‰cocoapodsé‡Œï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿä¸èƒ½ç›´æ¥æ˜¯æœ‰Facebookå®˜æ–¹çš„ä¹ˆï¼Ÿè¿™é‡Œæ¶‰åŠåˆ°cocoapodsçš„å·¥ä½œåŸç†ï¼Œè¯·è‡ªè¡ŒGoogleã€‚åŒæ—¶éœ€è¦æ”¹åŸæœ‰çš„podspecçš„ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬éšæ„å“ªä¸€ä¸ªä¾èµ–çœ‹ä¸€çœ‹ï¼Œå®ƒæ¥è‡ªFBLazyVector.specã€‚
```ruby
require "json"

package = JSON.parse(File.read(File.join(__dir__, "..", "..", "package.json")))
version = package['version']

source = { :git => 'https://github.com/facebook/react-native.git' }
if version == '1000.0.0'
  # This is an unpublished version, use the latest commit hash of the react-native repo, which weâ€™re presumably in.
  source[:commit] = `git rev-parse HEAD`.strip
else
  source[:tag] = "v#{version}"
end

Pod::Spec.new do |s|
  s.name                   = "FBLazyVector"
  s.version                = version
  s.summary                = "-"  # TODO
  s.homepage               = "http://facebook.github.io/react-native/"
  s.license                = package["license"]
  s.author                 = "Facebook, Inc. and its affiliates"
  s.platforms              = { :ios => "9.0", :tvos => "9.2" }
  s.source                 = source
  s.source_files           = "**/*.{c,h,m,mm,cpp}"
  s.header_dir             = "FBLazyVector"
end
```
æˆ‘ä»¬ä¸»è¦ä¿®æ”¹ä¸¤å¤„ï¼š1. ç‰ˆæœ¬å·ï¼›2. source_filesã€‚ä¸€ç•ªæŠ˜è…¾ä¹‹åï¼Œç°åœ¨çš„ç§æœ‰cocoapodså·²ç»åˆ›å»ºå®Œæˆï¼Œä¸ºäº†ç¡®è®¤å®ƒå·¥ä½œæ­£å¸¸ï¼Œæˆ‘ä»¬å°†Podfileä¸­å¯¹äºæœ¬åœ°çš„ä¾èµ–æ”¹ä¸ºç§æœ‰è¿œç«¯ä¾èµ–:
```ruby
source 'https://github.com/iossocket/ReactNativeLib.git'
source 'https://github.com/CocoaPods/Specs.git'

platform :ios, '9.0'

target 'Hybrid' do
  # Pods for Hybrid
  pod 'FBLazyVector'
  pod 'FBReactNativeSpec'
  pod 'RCTRequired'
  pod 'RCTTypeSafety'
  pod 'React'
  pod 'React-Core'
  pod 'React-CoreModules'
  pod 'React-Core/DevSupport'
  pod 'React-RCTActionSheet'
  pod 'React-RCTAnimation'
  pod 'React-RCTBlob'
  pod 'React-RCTImage'
  pod 'React-RCTLinking'
  pod 'React-RCTNetwork'
  pod 'React-RCTSettings'
  pod 'React-RCTText'
  pod 'React-RCTVibration'
  pod 'React-Core/RCTWebSocket'

  pod 'React-cxxreact'
  pod 'React-jsi'
  pod 'React-jsiexecutor'
  pod 'React-jsinspector'
  pod 'ReactCommon/jscallinvoker'
  pod 'ReactCommon/turbomodule/core'
  pod 'Yoga'

  pod 'DoubleConversion'
  pod 'glog'
  pod 'Folly'

  target 'HybridTests' do
    inherit! :search_paths
    # Pods for testing
  end
end
```
åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šäº†ç§æœ‰æºä¸ºhttps://github.com/iossocket/ReactNativeLib.gitï¼Œé‡æ–°æ‰§è¡Œ`pod install`ï¼Œä¸€åˆ‡æ­£å¸¸ï¼Œä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å¼€å§‹æ„å»ºè‡ªå·±moduleå•¦ã€‚

2. åˆ›å»ºä¸€ä¸ªReact Viewçš„å®¹å™¨
æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªCocoapodsçš„æ¨¡æ¿å·¥ç¨‹`pod lib create RNContrainer`ï¼Œ[RNContrainer](https://github.com/iossocket/RNContainer)ï¼Œå…¶ä¸­æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š
```
- (UIViewController *)viewControllerByRoute:(NSString *)routeName withParams:(NSDictionary *)params {
  UIViewController *viewController = [[UIViewController alloc] init];
  RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:[RNBridge sharedBridge].bridge
                                                   moduleName:routeName
                                            initialProperties:params];
  viewController.view = rootView;
  return viewController;
}
```
åˆ›å»ºä¸€ä¸ªä»¥RCTRootViewä¸ºroot viewçš„UIViewControllerã€‚å…¶ä»–ä»£ç è¯·å‚è€ƒ[RNContrainer](https://github.com/iossocket/RNContainer)ï¼Œç”Ÿæˆä¹‹åè¯·åˆ«å¿˜äº†è¦æ·»åŠ åˆ°è‡ªå·±çš„ç§æœ‰Cocoapodsä¸­å“Ÿã€‚
```
Pod::Spec.new do |s|
  s.name             = 'RNContainer'
  s.version          = '0.1.0'
  s.summary          = 'A short description of RNContainer.'
  s.description      = <<-DESC
                       DESC
  s.homepage         = 'https://github.com/iossocket/RNContainer'
  s.license          = { :type => 'MIT', :file => 'LICENSE' }
  s.author           = { 'iossocket' => 'avx302@gmail.com' }
  s.source           = { :git => 'https://github.com/iossocket/RNContainer.git', :tag => s.version.to_s }

  s.ios.deployment_target = '10.0'
  s.source_files = 'RNContainer/Classes/**/*'
  
  s.dependency 'FBLazyVector'
  s.dependency 'FBReactNativeSpec'
  s.dependency 'RCTRequired'
  s.dependency 'RCTTypeSafety'
  s.dependency 'React'
  s.dependency 'React-Core'
  s.dependency 'React-CoreModules'
  s.dependency 'React-Core/DevSupport'
  s.dependency 'React-RCTActionSheet'
  s.dependency 'React-RCTAnimation'
  s.dependency 'React-RCTBlob'
  s.dependency 'React-RCTImage'
  s.dependency 'React-RCTLinking'
  s.dependency 'React-RCTNetwork'
  s.dependency 'React-RCTSettings'
  s.dependency 'React-RCTText'
  s.dependency 'React-RCTVibration'
  s.dependency 'React-Core/RCTWebSocket'

  s.dependency 'React-cxxreact'
  s.dependency 'React-jsi'
  s.dependency 'React-jsiexecutor'
  s.dependency 'React-jsinspector'
  s.dependency 'ReactCommon/jscallinvoker'
  s.dependency 'ReactCommon/turbomodule/core'
  s.dependency 'Yoga'

  s.dependency 'DoubleConversion'
  s.dependency 'glog'
  s.dependency 'Folly'
end
```
3. ä½¿ç”¨RNContainer
ä½¿ç”¨æ–¹æ³•ä¹Ÿå°±æ˜äº†äº†ï¼Œåœ¨Podfileä¸­
```
source 'https://github.com/iossocket/ReactNativeLib.git'
source 'https://github.com/CocoaPods/Specs.git'
platform :ios, '10.0'
target 'Hybrid' do
  pod 'RNContainer'
end
```
ä½¿ç”¨æ—¶
```
#import "RNContainer.h"
...
[[RNContainer alloc] viewControllerByRoute:@"Hybrid"];
...
```
å…¶ä¸­å‚æ•°ä¸ºRNä¸­æ³¨å†Œçš„app nameã€‚

### ä»¥Libraryçš„æ–¹å¼ä½¿ç”¨RNçš„å»ºè®®æ‰“å¼€æ–¹å¼
1. è´Ÿè´£RNæ¨¡å—å¼€å‘çš„å›¢é˜Ÿï¼ŒæŒ‰ç…§å®˜æ–¹å»ºè®®çš„æ–¹å¼ï¼Œåˆ›å»ºRNé¡¹ç›®ï¼Œæ­£å¸¸å¼€å‘ã€‚
2. åœ¨pipelineä¸Šï¼Œç¼–å†™è„šæœ¬ï¼Œç”ŸæˆRNçš„jsbundleä»¥åŠç›¸åº”çš„å¤šåª’ä½“èµ„æºï¼Œå¹¶å°†å…¶æäº¤å¦‚RNContainerä¸­å¹¶æ‰“tagï¼Œæ›´æ–°podspecæ–‡ä»¶ï¼Œæ·»åŠ resourceå­—æ®µï¼Œå°†æ–°ç‰ˆæœ¬pushåˆ°ç§æœ‰Cocoapodsä¸­ã€‚
3. è´Ÿè´£ä¸»åº”ç”¨çš„å›¢é˜Ÿï¼Œæ›´æ–°Podfileä¸­RNContainerçš„ç‰ˆæœ¬å·ï¼Œæ¶ˆè´¹å…¶æä¾›çš„ViewControllerï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç»„ä»¶åŒ–æ–¹æ¡ˆè¿›è¡Œé›†æˆå¦‚Target-Actionã€‚

> å¼Šç«¯ï¼šRNçš„å‡çº§éœ€è¦æ›´åŠ è°¨æ…ï¼Œå½“RNå›¢é˜Ÿéœ€è¦ä½¿ç”¨åŒ…å«Nativeä»£ç çš„ä¸‰æ–¹åº“æ—¶ï¼Œéœ€è¦å°†è¿™ä¸ªä¾èµ–æ·»åŠ åˆ°RNContainerä¸­

å¦‚æœæ‚¨å¯¹äºæ„å»ºæ–¹å¼æœ‰å…¶ä»–æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·æ¢è®¨ã€‚

## How to build Framework

Install cocoapods-packager: `gem install cocoapods-packager`

```
pod package RNContainer.podspec --force --embedded --no-mangle --spec-sources=https://github.com/iossocket/ReactNativeLib.git,https://github.com/CocoaPods/Specs.git
```
